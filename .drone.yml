---
clone:
  disable: true
image_pull_secrets:
- dockerconfigjson
kind: pipeline
name: sanity
node:
  hw: linuxcpu
platform:
  arch: amd64
  os: linux
steps:
- commands:
  - mkdir -p src.orig && cd src.orig
  - /usr/local/bin/clone-commit
  - git submodule update --init --recursive
  - cd ..
  - aws s3 sync s3://mxnet-ci-drone-ccache/sanity-ccache /drone/src/ccache --no-progress
    --size-only --quiet || true
  - /ci/setup_ccache.sh
  - ls -liaF && du -hs *
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/buildtools
  name: clone-src
- commands:
  - . /ci/setup_build_env.sh
  - cp -r src.orig $FLAVOR_BUILD_DIR
  - cd $FLAVOR_BUILD_DIR
  - ls -liaF
  - set
  - ccache --zero-stats
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - mkdir -p $FLAVOR_BUILD_DIR/build
  - pwd && ls -liaF
  - make DEV=1 USE_TVM_OP=1 USE_CPP_PACKAGE=1 USE_BLAS=openblas USE_MKLDNN=0 USE_DIST_KVSTORE=1
    USE_LIBJPEG_TURBO=1 USE_SIGNAL_HANDLER=1 -j8
  - ccache -s
  - pwd && find . -name libmxnet.so
  - find $FLAVOR_BUILD_DIR -name libmxnet.so
  depends_on:
  - clone-src
  environment:
    FLAVOR_BUILD_DIR: /drone/src/sanity
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_cpu
  name: compile
- commands:
  - . /ci/setup_test_env.sh
  - cd $FLAVOR_BUILD_DIR
  - set
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - pwd && ls -liaF && find . -name libmxnet.so
  - cd python && pip install -e . && cd ..
  - MXNET_TEST_COUNT=1 nosetests --nocapture tests/python/unittest/test_operator.py:test_norm
  depends_on:
  - compile
  environment:
    FLAVOR_BUILD_DIR: /drone/src/sanity
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_cpu
  name: test-python
- commands:
  - ls -liaF && du -hs *
  - aws s3 sync /drone/src/ccache s3://mxnet-ci-drone-ccache/sanity-ccache --delete
    --no-progress --size-only --quiet || true
  depends_on:
  - compile
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/buildtools
  name: build-cleanup
  when:
    status:
    - failure
    - success
type: docker
---
clone:
  disable: true
depends_on:
- sanity
image_pull_secrets:
- dockerconfigjson
kind: pipeline
name: unix-cpu-openblas
node:
  hw: linuxcpu
platform:
  arch: amd64
  os: linux
steps:
- commands:
  - mkdir -p src.orig && cd src.orig
  - /usr/local/bin/clone-commit
  - git submodule update --init --recursive
  - cd ..
  - aws s3 sync s3://mxnet-ci-drone-ccache/unix-cpu-openblas-ccache /drone/src/ccache
    --no-progress --size-only --quiet || true
  - /ci/setup_ccache.sh
  - ls -liaF && du -hs *
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/buildtools
  name: clone-src
- commands:
  - . /ci/setup_build_env.sh
  - cp -r src.orig $FLAVOR_BUILD_DIR
  - cd $FLAVOR_BUILD_DIR
  - ls -liaF
  - set
  - ccache --zero-stats
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - mkdir -p $FLAVOR_BUILD_DIR/build
  - /work/runtime_functions.sh build_ubuntu_cpu
  - find / -name libmxnet.so
  - ccache -s
  - pwd && find . -name libmxnet.so
  - find $FLAVOR_BUILD_DIR -name libmxnet.so
  depends_on:
  - clone-src
  environment:
    FLAVOR_BUILD_DIR: /drone/src/unix-cpu-openblas
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_cpu
  name: compile
- commands:
  - . /ci/setup_test_env.sh
  - cd $FLAVOR_BUILD_DIR
  - set
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - pwd && ls -liaF && find . -name libmxnet.so
  - /work/runtime_functions.sh unittest_ubuntu_python3_cpu
  depends_on:
  - compile
  environment:
    FLAVOR_BUILD_DIR: /drone/src/unix-cpu-openblas
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_cpu
  name: test-python3
- commands:
  - . /ci/setup_test_env.sh
  - cd $FLAVOR_BUILD_DIR
  - set
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - pwd && ls -liaF && find . -name libmxnet.so
  - mkdir -p $FLAVOR_BUILD_DIR/.m2 && rm -rf /root/.m2 && ln -sf $FLAVOR_BUILD_DIR/.m2
    /root/.m2
  - cd scala-package
  - mvn -B install -DskipTests=true
  depends_on:
  - compile
  environment:
    FLAVOR_BUILD_DIR: /drone/src/unix-cpu-openblas
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_cpu
  name: test-scala-prep
- commands:
  - . /ci/setup_test_env.sh
  - cd $FLAVOR_BUILD_DIR
  - set
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - pwd && ls -liaF && find . -name libmxnet.so
  - mkdir -p $FLAVOR_BUILD_DIR/.m2 && rm -rf /root/.m2 && ln -sf $FLAVOR_BUILD_DIR/.m2
    /root/.m2
  - cd scala-package
  - mvn -B verify -DskipTests=false
  depends_on:
  - test-scala-prep
  environment:
    FLAVOR_BUILD_DIR: /drone/src/unix-cpu-openblas
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_cpu
  name: test-scala
- commands:
  - . /ci/setup_test_env.sh
  - cd $FLAVOR_BUILD_DIR
  - set
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - pwd && ls -liaF && find . -name libmxnet.so
  - mkdir -p $FLAVOR_BUILD_DIR/.m2 && rm -rf /root/.m2 && ln -sf $FLAVOR_BUILD_DIR/.m2
    /root/.m2
  - MXNET_HOME=$FLAVOR_BUILD_DIR contrib/clojure-package/scripts/get_cifar_data.sh
  - MXNET_HOME=$FLAVOR_BUILD_DIR contrib/clojure-package/scripts/get_mnist_data.sh
  - cd contrib/clojure-package
  - lein test
  - lein cloverage --codecov
  depends_on:
  - test-scala-prep
  environment:
    FLAVOR_BUILD_DIR: /drone/src/unix-cpu-openblas
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_cpu
  name: test-clojure
- commands:
  - . /ci/setup_test_env.sh
  - cd $FLAVOR_BUILD_DIR
  - set
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - pwd && ls -liaF && find . -name libmxnet.so
  - mkdir -p $FLAVOR_BUILD_DIR/.m2 && rm -rf /root/.m2 && ln -sf $FLAVOR_BUILD_DIR/.m2
    /root/.m2
  - cd contrib/clojure-package
  - lein install
  - TEST_CASES=$(find $MXNET_HOME/contrib/clojure-package/examples -name test -type
    d | awk '!/dontselect1|cnn-text-classification|gan|neural-style|pre-trained-models|profiler/')
  - for i in $TEST_CASES; do cd $i && lein test && cd ..; done
  depends_on:
  - test-scala-prep
  environment:
    FLAVOR_BUILD_DIR: /drone/src/unix-cpu-openblas
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_cpu
  name: test-clojure-integration
- commands:
  - . /ci/setup_test_env.sh
  - cd $FLAVOR_BUILD_DIR
  - set
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - pwd && ls -liaF && find . -name libmxnet.so
  - /work/runtime_functions.sh unittest_ubuntu_cpugpu_perl
  depends_on:
  - compile
  environment:
    FLAVOR_BUILD_DIR: /drone/src/unix-cpu-openblas
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_cpu
  name: test-perl
- commands:
  - . /ci/setup_test_env.sh
  - cd $FLAVOR_BUILD_DIR
  - set
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - pwd && ls -liaF && find . -name libmxnet.so
  - apt-get update
  - apt-get -y install libcurl4-gnutls-dev
  - /work/runtime_functions.sh unittest_ubuntu_cpu_R
  depends_on:
  - compile
  environment:
    FLAVOR_BUILD_DIR: /drone/src/unix-cpu-openblas
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_cpu
  name: test-r
- commands:
  - . /ci/setup_test_env.sh
  - cd $FLAVOR_BUILD_DIR
  - set
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - pwd && ls -liaF && find . -name libmxnet.so
  - /work/runtime_functions.sh unittest_ubuntu_cpu_julia07
  depends_on:
  - compile
  environment:
    FLAVOR_BUILD_DIR: /drone/src/unix-cpu-openblas
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_cpu
  name: test-julia-0.7
- commands:
  - . /ci/setup_test_env.sh
  - cd $FLAVOR_BUILD_DIR
  - set
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - pwd && ls -liaF && find . -name libmxnet.so
  - /work/runtime_functions.sh unittest_ubuntu_cpu_julia10
  depends_on:
  - compile
  environment:
    FLAVOR_BUILD_DIR: /drone/src/unix-cpu-openblas
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_cpu
  name: test-julia-1.0
- commands:
  - . /ci/setup_test_env.sh
  - cd $FLAVOR_BUILD_DIR
  - set
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - pwd && ls -liaF && find . -name libmxnet.so
  - /work/runtime_functions.sh integrationtest_ubuntu_cpu_onnx
  depends_on:
  - compile
  environment:
    FLAVOR_BUILD_DIR: /drone/src/unix-cpu-openblas
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_cpu
  name: test-onnx
- commands:
  - ls -liaF && du -hs *
  - aws s3 sync /drone/src/ccache s3://mxnet-ci-drone-ccache/unix-cpu-openblas-ccache
    --delete --no-progress --size-only --quiet || true
  depends_on:
  - compile
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/buildtools
  name: build-cleanup
  when:
    status:
    - failure
    - success
type: docker
---
clone:
  disable: true
depends_on:
- sanity
image_pull_secrets:
- dockerconfigjson
kind: pipeline
name: unix-cpu-openblas-debug
node:
  hw: linuxcpu
platform:
  arch: amd64
  os: linux
steps:
- commands:
  - mkdir -p src.orig && cd src.orig
  - /usr/local/bin/clone-commit
  - git submodule update --init --recursive
  - cd ..
  - aws s3 sync s3://mxnet-ci-drone-ccache/unix-cpu-openblas-debug-ccache /drone/src/ccache
    --no-progress --size-only --quiet || true
  - /ci/setup_ccache.sh
  - ls -liaF && du -hs *
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/buildtools
  name: clone-src
- commands:
  - . /ci/setup_build_env.sh
  - cp -r src.orig $FLAVOR_BUILD_DIR
  - cd $FLAVOR_BUILD_DIR
  - ls -liaF
  - set
  - ccache --zero-stats
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - mkdir -p $FLAVOR_BUILD_DIR/build
  - cd build
  - cmake -DUSE_CUDA=OFF -DUSE_TVM_OP=ON -DPython3_EXECUTABLE=/usr/bin/python3 -DUSE_MKL_IF_AVAILABLE=OFF
    -DUSE_OPENMP=OFF -DUSE_OPENCV=ON -DUSE_SIGNAL_HANDLER=ON -DCMAKE_BUILD_TYPE=Debug
    -G Ninja ..
  - ninja -j8
  - find / -name libmxnet.so
  - ccache -s
  - pwd && find . -name libmxnet.so
  - find $FLAVOR_BUILD_DIR -name libmxnet.so
  depends_on:
  - clone-src
  environment:
    FLAVOR_BUILD_DIR: /drone/src/unix-cpu-openblas-debug
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_cpu
  name: compile
- commands:
  - . /ci/setup_test_env.sh
  - cd $FLAVOR_BUILD_DIR
  - set
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - pwd && ls -liaF && find . -name libmxnet.so
  - /work/runtime_functions.sh unittest_ubuntu_python3_cpu
  depends_on:
  - compile
  environment:
    FLAVOR_BUILD_DIR: /drone/src/unix-cpu-openblas-debug
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_cpu
  name: test-python3
- commands:
  - . /ci/setup_test_env.sh
  - cd $FLAVOR_BUILD_DIR
  - set
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - pwd && ls -liaF && find . -name libmxnet.so
  - find . -name mxnet_unit_tests
  - ls -liaF build/tests/mxnet_unit_tests
  - ldd build/tests/mxnet_unit_tests
  - build/tests/mxnet_unit_tests
  depends_on:
  - compile
  environment:
    FLAVOR_BUILD_DIR: /drone/src/unix-cpu-openblas-debug
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_cpu
  name: test-cpp
- commands:
  - ls -liaF && du -hs *
  - aws s3 sync /drone/src/ccache s3://mxnet-ci-drone-ccache/unix-cpu-openblas-debug-ccache
    --delete --no-progress --size-only --quiet || true
  depends_on:
  - compile
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/buildtools
  name: build-cleanup
  when:
    status:
    - failure
    - success
type: docker
---
clone:
  disable: true
depends_on:
- sanity
image_pull_secrets:
- dockerconfigjson
kind: pipeline
name: unix-cpu-mkl
node:
  hw: linuxcpu
platform:
  arch: amd64
  os: linux
steps:
- commands:
  - mkdir -p src.orig && cd src.orig
  - /usr/local/bin/clone-commit
  - git submodule update --init --recursive
  - cd ..
  - aws s3 sync s3://mxnet-ci-drone-ccache/unix-cpu-mkl-ccache /drone/src/ccache --no-progress
    --size-only --quiet || true
  - /ci/setup_ccache.sh
  - ls -liaF && du -hs *
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/buildtools
  name: clone-src
- commands:
  - . /ci/setup_build_env.sh
  - cp -r src.orig $FLAVOR_BUILD_DIR
  - cd $FLAVOR_BUILD_DIR
  - ls -liaF
  - set
  - ccache --zero-stats
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - mkdir -p $FLAVOR_BUILD_DIR/build
  - make DEV=1 USE_CPP_PACKAGE=1 USE_BLAS=mkl USE_TVM_OP=1 USE_MKLDNN=0 USE_INTEL_PATH=/opt/intel
    USE_DIST_KVSTORE=1 USE_SIGNAL_HANDLER=1 -j8
  - find / -name libmxnet.so
  - ccache -s
  - pwd && find . -name libmxnet.so
  - find $FLAVOR_BUILD_DIR -name libmxnet.so
  depends_on:
  - clone-src
  environment:
    FLAVOR_BUILD_DIR: /drone/src/unix-cpu-mkl
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_cpu
  name: compile
- commands:
  - . /ci/setup_test_env.sh
  - cd $FLAVOR_BUILD_DIR
  - set
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - pwd && ls -liaF && find . -name libmxnet.so
  - /work/runtime_functions.sh unittest_ubuntu_python3_cpu
  depends_on:
  - compile
  environment:
    FLAVOR_BUILD_DIR: /drone/src/unix-cpu-mkl
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_cpu
  name: test-python3
- commands:
  - ls -liaF && du -hs *
  - aws s3 sync /drone/src/ccache s3://mxnet-ci-drone-ccache/unix-cpu-mkl-ccache --delete
    --no-progress --size-only --quiet || true
  depends_on:
  - compile
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/buildtools
  name: build-cleanup
  when:
    status:
    - failure
    - success
type: docker
---
clone:
  disable: true
depends_on:
- sanity
image_pull_secrets:
- dockerconfigjson
kind: pipeline
name: unix-cpu-mkldnn
node:
  hw: linuxcpu
platform:
  arch: amd64
  os: linux
steps:
- commands:
  - mkdir -p src.orig && cd src.orig
  - /usr/local/bin/clone-commit
  - git submodule update --init --recursive
  - cd ..
  - aws s3 sync s3://mxnet-ci-drone-ccache/unix-cpu-mkldnn-ccache /drone/src/ccache
    --no-progress --size-only --quiet || true
  - /ci/setup_ccache.sh
  - ls -liaF && du -hs *
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/buildtools
  name: clone-src
- commands:
  - . /ci/setup_build_env.sh
  - cp -r src.orig $FLAVOR_BUILD_DIR
  - cd $FLAVOR_BUILD_DIR
  - ls -liaF
  - set
  - ccache --zero-stats
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - mkdir -p $FLAVOR_BUILD_DIR/build
  - make DEV=1 USE_CPP_PACKAGE=1 USE_TVM_OP=1 USE_BLAS=openblas USE_SIGNAL_HANDLER=1
    -j8
  - find / -name libmxnet.so
  - ccache -s
  - pwd && find . -name libmxnet.so
  - find $FLAVOR_BUILD_DIR -name libmxnet.so
  depends_on:
  - clone-src
  environment:
    FLAVOR_BUILD_DIR: /drone/src/unix-cpu-mkldnn
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_cpu
  name: compile
- commands:
  - . /ci/setup_test_env.sh
  - cd $FLAVOR_BUILD_DIR
  - set
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - pwd && ls -liaF && find . -name libmxnet.so
  - /work/runtime_functions.sh unittest_ubuntu_python3_cpu_mkldnn
  depends_on:
  - compile
  environment:
    FLAVOR_BUILD_DIR: /drone/src/unix-cpu-mkldnn
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_cpu
  name: test-python3
- commands:
  - . /ci/setup_test_env.sh
  - cd $FLAVOR_BUILD_DIR
  - set
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - pwd && ls -liaF && find . -name libmxnet.so
  - /work/runtime_functions.sh integrationtest_ubuntu_cpu_scala
  depends_on:
  - compile
  environment:
    FLAVOR_BUILD_DIR: /drone/src/unix-cpu-mkldnn
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_cpu
  name: test-scala
- commands:
  - . /ci/setup_test_env.sh
  - cd $FLAVOR_BUILD_DIR
  - set
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - pwd && ls -liaF && find . -name libmxnet.so
  - /work/runtime_functions.sh unittest_ubuntu_minimal_R
  depends_on:
  - compile
  environment:
    FLAVOR_BUILD_DIR: /drone/src/unix-cpu-mkldnn
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_cpu
  name: test-r
- commands:
  - ls -liaF && du -hs *
  - aws s3 sync /drone/src/ccache s3://mxnet-ci-drone-ccache/unix-cpu-mkldnn-ccache
    --delete --no-progress --size-only --quiet || true
  depends_on:
  - compile
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/buildtools
  name: build-cleanup
  when:
    status:
    - failure
    - success
type: docker
---
clone:
  disable: true
depends_on:
- sanity
image_pull_secrets:
- dockerconfigjson
kind: pipeline
name: unix-cpu-mkldnn-mkl
node:
  hw: linuxcpu
platform:
  arch: amd64
  os: linux
steps:
- commands:
  - mkdir -p src.orig && cd src.orig
  - /usr/local/bin/clone-commit
  - git submodule update --init --recursive
  - cd ..
  - aws s3 sync s3://mxnet-ci-drone-ccache/unix-cpu-mkldnn-mkl-ccache /drone/src/ccache
    --no-progress --size-only --quiet || true
  - /ci/setup_ccache.sh
  - ls -liaF && du -hs *
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/buildtools
  name: clone-src
- commands:
  - . /ci/setup_build_env.sh
  - cp -r src.orig $FLAVOR_BUILD_DIR
  - cd $FLAVOR_BUILD_DIR
  - ls -liaF
  - set
  - ccache --zero-stats
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - mkdir -p $FLAVOR_BUILD_DIR/build
  - make DEV=1 USE_CPP_PACKAGE=1 USE_TVM_OP=1 USE_BLAS=mkl USE_SIGNAL_HANDLER=1 USE_INTEL_PATH=/opt/intel
    -j8
  - find / -name libmxnet.so
  - ccache -s
  - pwd && find . -name libmxnet.so
  - find $FLAVOR_BUILD_DIR -name libmxnet.so
  depends_on:
  - clone-src
  environment:
    FLAVOR_BUILD_DIR: /drone/src/unix-cpu-mkldnn-mkl
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_cpu
  name: compile
- commands:
  - . /ci/setup_test_env.sh
  - cd $FLAVOR_BUILD_DIR
  - set
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - pwd && ls -liaF && find . -name libmxnet.so
  - /work/runtime_functions.sh unittest_ubuntu_python3_cpu_mkldnn
  depends_on:
  - compile
  environment:
    FLAVOR_BUILD_DIR: /drone/src/unix-cpu-mkldnn-mkl
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_cpu
  name: test-python3
- commands:
  - ls -liaF && du -hs *
  - aws s3 sync /drone/src/ccache s3://mxnet-ci-drone-ccache/unix-cpu-mkldnn-mkl-ccache
    --delete --no-progress --size-only --quiet || true
  depends_on:
  - compile
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/buildtools
  name: build-cleanup
  when:
    status:
    - failure
    - success
type: docker
---
clone:
  disable: true
depends_on:
- sanity
image_pull_secrets:
- dockerconfigjson
kind: pipeline
name: unix-cpu-openblas-no-tvm-op
node:
  hw: linuxcpu
platform:
  arch: amd64
  os: linux
steps:
- commands:
  - mkdir -p src.orig && cd src.orig
  - /usr/local/bin/clone-commit
  - git submodule update --init --recursive
  - cd ..
  - aws s3 sync s3://mxnet-ci-drone-ccache/unix-cpu-openblas-no-tvm-op-ccache /drone/src/ccache
    --no-progress --size-only --quiet || true
  - /ci/setup_ccache.sh
  - ls -liaF && du -hs *
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/buildtools
  name: clone-src
- commands:
  - . /ci/setup_build_env.sh
  - cp -r src.orig $FLAVOR_BUILD_DIR
  - cd $FLAVOR_BUILD_DIR
  - ls -liaF
  - set
  - ccache --zero-stats
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - mkdir -p $FLAVOR_BUILD_DIR/build
  - cd build
  - cmake -DUSE_CUDA=OFF -DUSE_TVM_OP=OFF -DPython3_EXECUTABLE=/usr/bin/python3 -DUSE_MKL_IF_AVAILABLE=OFF
    -DUSE_OPENMP=OFF -DUSE_OPENCV=ON -DUSE_SIGNAL_HANDLER=ON -DCMAKE_BUILD_TYPE=Release
    -G Ninja ..
  - ninja -j8
  - find / -name libmxnet.so
  - ccache -s
  - pwd && find . -name libmxnet.so
  - find $FLAVOR_BUILD_DIR -name libmxnet.so
  depends_on:
  - clone-src
  environment:
    FLAVOR_BUILD_DIR: /drone/src/unix-cpu-openblas-no-tvm-op
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_cpu
  name: compile
- commands:
  - . /ci/setup_test_env.sh
  - cd $FLAVOR_BUILD_DIR
  - set
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - pwd && ls -liaF && find . -name libmxnet.so
  - /work/runtime_functions.sh unittest_ubuntu_python3_cpu
  depends_on:
  - compile
  environment:
    FLAVOR_BUILD_DIR: /drone/src/unix-cpu-openblas-no-tvm-op
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_cpu
  name: test-python3
- commands:
  - ls -liaF && du -hs *
  - aws s3 sync /drone/src/ccache s3://mxnet-ci-drone-ccache/unix-cpu-openblas-no-tvm-op-ccache
    --delete --no-progress --size-only --quiet || true
  depends_on:
  - compile
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/buildtools
  name: build-cleanup
  when:
    status:
    - failure
    - success
type: docker
---
clone:
  disable: true
depends_on:
- sanity
image_pull_secrets:
- dockerconfigjson
kind: pipeline
name: unix-gpu-mkldnn
node:
  hw: linuxgpu
platform:
  arch: amd64
  os: linux
steps:
- commands:
  - mkdir -p src.orig && cd src.orig
  - /usr/local/bin/clone-commit
  - git submodule update --init --recursive
  - cd ..
  - aws s3 sync s3://mxnet-ci-drone-ccache/unix-gpu-mkldnn-ccache /drone/src/ccache
    --no-progress --size-only --quiet || true
  - /ci/setup_ccache.sh
  - ls -liaF && du -hs *
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/buildtools
  name: clone-src
- commands:
  - . /ci/setup_build_env.sh
  - cp -r src.orig $FLAVOR_BUILD_DIR
  - cd $FLAVOR_BUILD_DIR
  - ls -liaF
  - set
  - ccache --zero-stats
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - mkdir -p $FLAVOR_BUILD_DIR/build
  - /work/runtime_functions.sh build_ubuntu_gpu_mkldnn
  - ccache -s
  - pwd && find . -name libmxnet.so
  - find $FLAVOR_BUILD_DIR -name libmxnet.so
  depends_on:
  - clone-src
  environment:
    FLAVOR_BUILD_DIR: /drone/src/unix-gpu-mkldnn
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_build_cuda
  name: compile
- commands:
  - . /ci/setup_test_env.sh
  - cd $FLAVOR_BUILD_DIR
  - set
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - pwd && ls -liaF && find . -name libmxnet.so
  - /work/runtime_functions.sh unittest_ubuntu_python3_gpu
  depends_on:
  - compile
  environment:
    FLAVOR_BUILD_DIR: /drone/src/unix-gpu-mkldnn
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_gpu_cu101
  name: test-python3
- commands:
  - ls -liaF && du -hs *
  - aws s3 sync /drone/src/ccache s3://mxnet-ci-drone-ccache/unix-gpu-mkldnn-ccache
    --delete --no-progress --size-only --quiet || true
  depends_on:
  - compile
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/buildtools
  name: build-cleanup
  when:
    status:
    - failure
    - success
type: docker
---
clone:
  disable: true
depends_on:
- sanity
image_pull_secrets:
- dockerconfigjson
kind: pipeline
name: unix-gpu-mkldnn-nocudnn
node:
  hw: linuxgpu
platform:
  arch: amd64
  os: linux
steps:
- commands:
  - mkdir -p src.orig && cd src.orig
  - /usr/local/bin/clone-commit
  - git submodule update --init --recursive
  - cd ..
  - aws s3 sync s3://mxnet-ci-drone-ccache/unix-gpu-mkldnn-nocudnn-ccache /drone/src/ccache
    --no-progress --size-only --quiet || true
  - /ci/setup_ccache.sh
  - ls -liaF && du -hs *
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/buildtools
  name: clone-src
- commands:
  - . /ci/setup_build_env.sh
  - cp -r src.orig $FLAVOR_BUILD_DIR
  - cd $FLAVOR_BUILD_DIR
  - ls -liaF
  - set
  - ccache --zero-stats
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - mkdir -p $FLAVOR_BUILD_DIR/build
  - /work/runtime_functions.sh build_ubuntu_gpu_mkldnn_nocudnn
  - ccache -s
  - pwd && find . -name libmxnet.so
  - find $FLAVOR_BUILD_DIR -name libmxnet.so
  depends_on:
  - clone-src
  environment:
    FLAVOR_BUILD_DIR: /drone/src/unix-gpu-mkldnn-nocudnn
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_build_cuda
  name: compile
- commands:
  - . /ci/setup_test_env.sh
  - cd $FLAVOR_BUILD_DIR
  - set
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - pwd && ls -liaF && find . -name libmxnet.so
  - /work/runtime_functions.sh unittest_ubuntu_python3_gpu_nocudnn
  depends_on:
  - compile
  environment:
    FLAVOR_BUILD_DIR: /drone/src/unix-gpu-mkldnn-nocudnn
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_gpu_cu101
  name: test-python3
- commands:
  - ls -liaF && du -hs *
  - aws s3 sync /drone/src/ccache s3://mxnet-ci-drone-ccache/unix-gpu-mkldnn-nocudnn-ccache
    --delete --no-progress --size-only --quiet || true
  depends_on:
  - compile
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/buildtools
  name: build-cleanup
  when:
    status:
    - failure
    - success
type: docker
---
clone:
  disable: true
depends_on:
- sanity
image_pull_secrets:
- dockerconfigjson
kind: pipeline
name: unix-gpu-full
node:
  hw: linuxgpu
platform:
  arch: amd64
  os: linux
steps:
- commands:
  - mkdir -p src.orig && cd src.orig
  - /usr/local/bin/clone-commit
  - git submodule update --init --recursive
  - cd ..
  - aws s3 sync s3://mxnet-ci-drone-ccache/unix-gpu-full-ccache /drone/src/ccache
    --no-progress --size-only --quiet || true
  - /ci/setup_ccache.sh
  - ls -liaF && du -hs *
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/buildtools
  name: clone-src
- commands:
  - . /ci/setup_build_env.sh
  - cp -r src.orig $FLAVOR_BUILD_DIR
  - cd $FLAVOR_BUILD_DIR
  - ls -liaF
  - set
  - ccache --zero-stats
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - mkdir -p $FLAVOR_BUILD_DIR/build
  - /work/runtime_functions.sh build_ubuntu_gpu_cuda101_cudnn7
  - ccache -s
  - pwd && find . -name libmxnet.so
  - find $FLAVOR_BUILD_DIR -name libmxnet.so
  depends_on:
  - clone-src
  environment:
    FLAVOR_BUILD_DIR: /drone/src/unix-gpu-full
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_build_cuda
  name: compile
- commands:
  - . /ci/setup_test_env.sh
  - cd $FLAVOR_BUILD_DIR
  - set
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - pwd && ls -liaF && find . -name libmxnet.so
  - /work/runtime_functions.sh unittest_ubuntu_python3_gpu_cython
  depends_on:
  - compile
  environment:
    FLAVOR_BUILD_DIR: /drone/src/unix-gpu-full
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_gpu_cu101
  name: test-python3
- commands:
  - . /ci/setup_test_env.sh
  - cd $FLAVOR_BUILD_DIR
  - set
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - pwd && ls -liaF && find . -name libmxnet.so
  - /work/runtime_functions.sh unittest_ubuntu_python3_quantization_gpu
  depends_on:
  - compile
  environment:
    FLAVOR_BUILD_DIR: /drone/src/unix-gpu-full
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_gpu_cu101
  name: test-python3-quantize
- commands:
  - . /ci/setup_test_env.sh
  - cd $FLAVOR_BUILD_DIR
  - set
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - pwd && ls -liaF && find . -name libmxnet.so
  - /work/runtime_functions.sh unittest_ubuntu_cpugpu_perl
  depends_on:
  - compile
  environment:
    FLAVOR_BUILD_DIR: /drone/src/unix-gpu-full
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_gpu_cu101
  name: test-perl
- commands:
  - . /ci/setup_test_env.sh
  - cd $FLAVOR_BUILD_DIR
  - set
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - pwd && ls -liaF && find . -name libmxnet.so
  - /work/runtime_functions.sh unittest_ubuntu_gpu_R
  depends_on:
  - compile
  environment:
    FLAVOR_BUILD_DIR: /drone/src/unix-gpu-full
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_gpu_cu101
  name: test-r
- commands:
  - . /ci/setup_test_env.sh
  - cd $FLAVOR_BUILD_DIR
  - set
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - pwd && ls -liaF && find . -name libmxnet.so
  - /work/runtime_functions.sh integrationtest_ubuntu_gpu_python
  depends_on:
  - compile
  environment:
    FLAVOR_BUILD_DIR: /drone/src/unix-gpu-full
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_gpu_cu101
  name: test-python3-integration
- commands:
  - . /ci/setup_test_env.sh
  - cd $FLAVOR_BUILD_DIR
  - set
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - pwd && ls -liaF && find . -name libmxnet.so
  - /work/runtime_functions.sh integrationtest_ubuntu_gpu_cpp_package
  depends_on:
  - compile
  environment:
    FLAVOR_BUILD_DIR: /drone/src/unix-gpu-full
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_gpu_cu101
  name: test-cpp-package
- commands:
  - . /ci/setup_test_env.sh
  - cd $FLAVOR_BUILD_DIR
  - set
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - pwd && ls -liaF && find . -name libmxnet.so
  - /work/runtime_functions.sh integrationtest_ubuntu_gpu_scala
  depends_on:
  - compile
  environment:
    FLAVOR_BUILD_DIR: /drone/src/unix-gpu-full
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_gpu_cu101
  name: test-scala
- commands:
  - . /ci/setup_test_env.sh
  - cd $FLAVOR_BUILD_DIR
  - set
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - pwd && ls -liaF && find . -name libmxnet.so
  - /work/runtime_functions.sh integrationtest_ubuntu_gpu_dist_kvstore
  depends_on:
  - compile
  environment:
    FLAVOR_BUILD_DIR: /drone/src/unix-gpu-full
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_gpu_cu101
  name: test-distributed-kvstore
- commands:
  - ls -liaF && du -hs *
  - aws s3 sync /drone/src/ccache s3://mxnet-ci-drone-ccache/unix-gpu-full-ccache
    --delete --no-progress --size-only --quiet || true
  depends_on:
  - compile
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/buildtools
  name: build-cleanup
  when:
    status:
    - failure
    - success
type: docker
---
clone:
  disable: true
depends_on:
- sanity
image_pull_secrets:
- dockerconfigjson
kind: pipeline
name: unix-gpu-cmake-mkldnn
node:
  hw: linuxgpu
platform:
  arch: amd64
  os: linux
steps:
- commands:
  - mkdir -p src.orig && cd src.orig
  - /usr/local/bin/clone-commit
  - git submodule update --init --recursive
  - cd ..
  - aws s3 sync s3://mxnet-ci-drone-ccache/unix-gpu-cmake-mkldnn-ccache /drone/src/ccache
    --no-progress --size-only --quiet || true
  - /ci/setup_ccache.sh
  - ls -liaF && du -hs *
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/buildtools
  name: clone-src
- commands:
  - . /ci/setup_build_env.sh
  - cp -r src.orig $FLAVOR_BUILD_DIR
  - cd $FLAVOR_BUILD_DIR
  - ls -liaF
  - set
  - ccache --zero-stats
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - mkdir -p $FLAVOR_BUILD_DIR/build
  - /work/runtime_functions.sh build_ubuntu_gpu_cmake_mkldnn
  - ccache -s
  - pwd && find . -name libmxnet.so
  - find $FLAVOR_BUILD_DIR -name libmxnet.so
  depends_on:
  - clone-src
  environment:
    FLAVOR_BUILD_DIR: /drone/src/unix-gpu-cmake-mkldnn
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_gpu_cu101
  name: compile
- commands:
  - . /ci/setup_test_env.sh
  - cd $FLAVOR_BUILD_DIR
  - set
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - pwd && ls -liaF && find . -name libmxnet.so
  - /work/runtime_functions.sh unittest_cpp
  depends_on:
  - compile
  environment:
    FLAVOR_BUILD_DIR: /drone/src/unix-gpu-cmake-mkldnn
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_gpu_cu101
  name: test-cpp
- commands:
  - ls -liaF && du -hs *
  - aws s3 sync /drone/src/ccache s3://mxnet-ci-drone-ccache/unix-gpu-cmake-mkldnn-ccache
    --delete --no-progress --size-only --quiet || true
  depends_on:
  - compile
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/buildtools
  name: build-cleanup
  when:
    status:
    - failure
    - success
type: docker
---
clone:
  disable: true
depends_on:
- sanity
image_pull_secrets:
- dockerconfigjson
kind: pipeline
name: unix-gpu-cmake
node:
  hw: linuxgpu
platform:
  arch: amd64
  os: linux
steps:
- commands:
  - mkdir -p src.orig && cd src.orig
  - /usr/local/bin/clone-commit
  - git submodule update --init --recursive
  - cd ..
  - aws s3 sync s3://mxnet-ci-drone-ccache/unix-gpu-cmake-ccache /drone/src/ccache
    --no-progress --size-only --quiet || true
  - /ci/setup_ccache.sh
  - ls -liaF && du -hs *
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/buildtools
  name: clone-src
- commands:
  - . /ci/setup_build_env.sh
  - cp -r src.orig $FLAVOR_BUILD_DIR
  - cd $FLAVOR_BUILD_DIR
  - ls -liaF
  - set
  - ccache --zero-stats
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - mkdir -p $FLAVOR_BUILD_DIR/build
  - /work/runtime_functions.sh build_ubuntu_gpu_cmake
  - ccache -s
  - pwd && find . -name libmxnet.so
  - find $FLAVOR_BUILD_DIR -name libmxnet.so
  depends_on:
  - clone-src
  environment:
    FLAVOR_BUILD_DIR: /drone/src/unix-gpu-cmake
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_gpu_cu101
  name: compile
- commands:
  - . /ci/setup_test_env.sh
  - cd $FLAVOR_BUILD_DIR
  - set
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - pwd && ls -liaF && find . -name libmxnet.so
  - /work/runtime_functions.sh unittest_cpp
  depends_on:
  - compile
  environment:
    FLAVOR_BUILD_DIR: /drone/src/unix-gpu-cmake
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_gpu_cu101
  name: test-cpp
- commands:
  - ls -liaF && du -hs *
  - aws s3 sync /drone/src/ccache s3://mxnet-ci-drone-ccache/unix-gpu-cmake-ccache
    --delete --no-progress --size-only --quiet || true
  depends_on:
  - compile
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/buildtools
  name: build-cleanup
  when:
    status:
    - failure
    - success
type: docker
---
clone:
  disable: true
depends_on:
- sanity
image_pull_secrets:
- dockerconfigjson
kind: pipeline
name: unix-gpu-tensorrt
node:
  hw: linuxgpu
platform:
  arch: amd64
  os: linux
steps:
- commands:
  - mkdir -p src.orig && cd src.orig
  - /usr/local/bin/clone-commit
  - git submodule update --init --recursive
  - cd ..
  - aws s3 sync s3://mxnet-ci-drone-ccache/unix-gpu-tensorrt-ccache /drone/src/ccache
    --no-progress --size-only --quiet || true
  - /ci/setup_ccache.sh
  - ls -liaF && du -hs *
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/buildtools
  name: clone-src
- commands:
  - . /ci/setup_build_env.sh
  - cp -r src.orig $FLAVOR_BUILD_DIR
  - cd $FLAVOR_BUILD_DIR
  - ls -liaF
  - set
  - ccache --zero-stats
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - mkdir -p $FLAVOR_BUILD_DIR/build
  - /work/runtime_functions.sh build_ubuntu_gpu_tensorrt
  - ccache -s
  - pwd && find . -name libmxnet.so
  - find $FLAVOR_BUILD_DIR -name libmxnet.so
  depends_on:
  - clone-src
  environment:
    FLAVOR_BUILD_DIR: /drone/src/unix-gpu-tensorrt
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_gpu_tensorrt
  name: compile
- commands:
  - . /ci/setup_test_env.sh
  - cd $FLAVOR_BUILD_DIR
  - set
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - pwd && ls -liaF && find . -name libmxnet.so
  - /work/runtime_functions.sh unittest_ubuntu_tensorrt_gpu
  depends_on:
  - compile
  environment:
    FLAVOR_BUILD_DIR: /drone/src/unix-gpu-tensorrt
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_gpu_tensorrt
  name: test-python3
- commands:
  - ls -liaF && du -hs *
  - aws s3 sync /drone/src/ccache s3://mxnet-ci-drone-ccache/unix-gpu-tensorrt-ccache
    --delete --no-progress --size-only --quiet || true
  depends_on:
  - compile
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/buildtools
  name: build-cleanup
  when:
    status:
    - failure
    - success
type: docker
---
clone:
  disable: true
depends_on:
- sanity
image_pull_secrets:
- dockerconfigjson
kind: pipeline
name: unix-gpu-no-tvm
node:
  hw: linuxgpu
platform:
  arch: amd64
  os: linux
steps:
- commands:
  - mkdir -p src.orig && cd src.orig
  - /usr/local/bin/clone-commit
  - git submodule update --init --recursive
  - cd ..
  - aws s3 sync s3://mxnet-ci-drone-ccache/unix-gpu-no-tvm-ccache /drone/src/ccache
    --no-progress --size-only --quiet || true
  - /ci/setup_ccache.sh
  - ls -liaF && du -hs *
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/buildtools
  name: clone-src
- commands:
  - . /ci/setup_build_env.sh
  - cp -r src.orig $FLAVOR_BUILD_DIR
  - cd $FLAVOR_BUILD_DIR
  - ls -liaF
  - set
  - ccache --zero-stats
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - mkdir -p $FLAVOR_BUILD_DIR/build
  - /work/runtime_functions.sh build_ubuntu_gpu_cuda101_cudnn7_no_tvm_op
  - ccache -s
  - pwd && find . -name libmxnet.so
  - find $FLAVOR_BUILD_DIR -name libmxnet.so
  depends_on:
  - clone-src
  environment:
    FLAVOR_BUILD_DIR: /drone/src/unix-gpu-no-tvm
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_build_cuda
  name: compile
- commands:
  - . /ci/setup_test_env.sh
  - cd $FLAVOR_BUILD_DIR
  - set
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - pwd && ls -liaF && find . -name libmxnet.so
  - /work/runtime_functions.sh unittest_ubuntu_python3_gpu_cython
  depends_on:
  - compile
  environment:
    FLAVOR_BUILD_DIR: /drone/src/unix-gpu-no-tvm
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_gpu_cu101
  name: test-python3
- commands:
  - ls -liaF && du -hs *
  - aws s3 sync /drone/src/ccache s3://mxnet-ci-drone-ccache/unix-gpu-no-tvm-ccache
    --delete --no-progress --size-only --quiet || true
  depends_on:
  - compile
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/buildtools
  name: build-cleanup
  when:
    status:
    - failure
    - success
type: docker
---
clone:
  disable: true
depends_on:
- sanity
image_pull_secrets:
- dockerconfigjson
kind: pipeline
name: unix-gpu-mkldnn-cpp
node:
  hw: linuxgpu
platform:
  arch: amd64
  os: linux
steps:
- commands:
  - mkdir -p src.orig && cd src.orig
  - /usr/local/bin/clone-commit
  - git submodule update --init --recursive
  - cd ..
  - aws s3 sync s3://mxnet-ci-drone-ccache/unix-gpu-mkldnn-cpp-ccache /drone/src/ccache
    --no-progress --size-only --quiet || true
  - /ci/setup_ccache.sh
  - ls -liaF && du -hs *
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/buildtools
  name: clone-src
- commands:
  - . /ci/setup_build_env.sh
  - cp -r src.orig $FLAVOR_BUILD_DIR
  - cd $FLAVOR_BUILD_DIR
  - ls -liaF
  - set
  - ccache --zero-stats
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - mkdir -p $FLAVOR_BUILD_DIR/build
  - /work/runtime_functions.sh build_ubuntu_gpu_cuda101_cudnn7_mkldnn_cpp_test
  - ccache -s
  - pwd && find . -name libmxnet.so
  - find $FLAVOR_BUILD_DIR -name libmxnet.so
  depends_on:
  - clone-src
  environment:
    FLAVOR_BUILD_DIR: /drone/src/unix-gpu-mkldnn-cpp
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_build_cuda
  name: compile
- commands:
  - . /ci/setup_test_env.sh
  - cd $FLAVOR_BUILD_DIR
  - set
  - rm -rf /work/mxnet && ln -sf $FLAVOR_BUILD_DIR /work/mxnet
  - pwd && ls -liaF && find . -name libmxnet.so
  - /work/runtime_functions.sh integrationtest_ubuntu_gpu_capi_cpp_package
  depends_on:
  - compile
  environment:
    FLAVOR_BUILD_DIR: /drone/src/unix-gpu-mkldnn-cpp
    NUMPROC: 4
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/ubuntu_gpu_cu101
  name: test-capi-cpp-package
- commands:
  - ls -liaF && du -hs *
  - aws s3 sync /drone/src/ccache s3://mxnet-ci-drone-ccache/unix-gpu-mkldnn-cpp-ccache
    --delete --no-progress --size-only --quiet || true
  depends_on:
  - compile
  image: 187885003319.dkr.ecr.us-west-2.amazonaws.com/mxnet-ci/buildtools
  name: build-cleanup
  when:
    status:
    - failure
    - success
type: docker
---
kind: signature
hmac: da79103e6b8554c3f955f6ec44dd4ae1341b2deb3b01d1c771cb63e65c82e658

...
